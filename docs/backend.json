{
  "entities": {
    "Drug": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Drug",
      "type": "object",
      "description": "Represents a drug in the hospital pharmacy's inventory.",
      "properties": {
        "barcode": {
          "type": "string",
          "description": "Unique identifier for the drug. (Primary Key)",
          "format": "string"
        },
        "designation": {
          "type": "string",
          "description": "Name or description of the drug."
        },
        "initialStock": {
          "type": "number",
          "description": "The initial quantity of the drug when first stocked."
        },
        "currentStock": {
          "type": "number",
          "description": "The current quantity of the drug in stock."
        },
        "lowStockThreshold": {
            "type": "number",
            "description": "The threshold below which the stock is considered low."
        },
        "expiryDate": {
          "type": "string",
          "description": "The expiration date of the drug.",
          "format": "date-time"
        },
        "lotNumber": {
          "type": "string",
          "description": "The lot number of the drug batch."
        },
        "category": {
          "type": "string",
          "description": "Category of the drug (e.g., Antibiotic, Analgesic)."
        },
        "createdAt": {
            "type": "string",
            "description": "The date when the drug was first added to the inventory.",
            "format": "date-time"
        },
        "updatedAt": {
            "type": "string",
            "description": "The date when the drug was last updated.",
            "format": "date-time"
        }
      },
      "required": [
        "barcode",
        "designation",
        "currentStock",
        "expiryDate",
        "lowStockThreshold"
      ]
    },
    "Distribution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Distribution",
      "type": "object",
      "description": "Represents the distribution of a drug to a specific service or section.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the distribution record. (Primary Key)"
        },
        "barcode": {
          "type": "string",
          "description": "Reference to Drug. (Relationship: Drug 1:N Distribution)"
        },
        "itemName": {
          "type": "string",
          "description": "Name of the distributed item, could be redundant but useful for denormalization."
        },
        "quantiteDistribuee": {
          "type": "number",
          "description": "The quantity of the drug distributed."
        },
        "serviceSection": {
          "type": "string",
          "description": "The service or section to which the drug was distributed."
        },
        "date": {
          "type": "string",
          "description": "The date of the distribution.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "barcode",
        "itemName",
        "quantiteDistribuee",
        "serviceSection",
        "date"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a medical service or section within the hospital.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service. (Primary Key)"
        },
        "name": {
          "type": "string",
          "description": "Name of the service or section (e.g., Emergencies, Surgery)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/drugs/{barcode}",
        "definition": {
          "entityName": "Drug",
          "schema": {
            "$ref": "#/backend/entities/Drug"
          },
          "description": "Stores information about each drug, using the barcode as the document ID.",
          "params": [
            {
              "name": "barcode",
              "description": "The unique barcode of the drug. (Primary Key)"
            }
          ]
        }
      },
      {
        "path": "/distributions/{id}",
        "definition": {
          "entityName": "Distribution",
          "schema": {
            "$ref": "#/backend/entities/Distribution"
          },
          "description": "Stores distribution records, with denormalized 'itemName' for authorization independence. This allows listing distributions securely without needing to access the drug document.",
          "params": [
            {
              "name": "id",
              "description": "The unique ID of the distribution record. (Primary Key)"
            }
          ]
        }
      },
      {
        "path": "/services/{id}",
        "definition": {
          "entityName": "Service",
          "schema": {
            "$ref": "#/backend/entities/Service"
          },
          "description": "Stores information about medical services or sections within the hospital.",
          "params": [
            {
              "name": "id",
              "description": "The unique ID of the service. (Primary Key)"
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage drug inventory and distribution within a hospital pharmacy, focusing on security, scalability, and ease of debugging. It leverages denormalization to ensure authorization independence, allowing atomic operations and simpler security rules. The structure separates data with different access requirements into distinct collections, following the Structural Segregation principle.  \n\n*Drugs*: Contains information about each drug.  \n*Distributions*: Stores distribution records. The `itemName` is denormalized from the `Drug` document based on the `barcode` to ensure Authorization Independence for distributions. This supports QAPs by allowing listing distributions without needing to access the drug document. \n*Services*: Contains information about medical services or sections within the hospital.\n\nAuthorization Independence is achieved by denormalizing `itemName` in the `distributions` collection.  This eliminates the need for `get()` calls in security rules when querying or modifying distributions. Segregation ensures that access rules for drugs, distributions, and services can be independently managed without conflicts.\n\nThe structure supports QAPs by segregating the `distributions` collection, each document containing necessary data for listing and filtering."
  }
}
